<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: modules/fortuna-api.module.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: modules/fortuna-api.module.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
const Promise = require('bluebird');
const r = require('request-promise');

const Environment = require('../helpers/environment.helper');
const Auth = require('./auth.module');

const env = Environment.get;
const config = require('../../config');


/** FortunaAPI
 * @description.   This module is available for use and is used by all other modules to call the API in a consistent way and handles authentication.    Use the methods to manually make a request to the API.
 */

class FortunaAPI {
    constructor() {

    }
    /** get
     * @description Performs a GET request.
     * @param {string} endpoint to be called.
     * @returns {Promise&lt;Object>} JSON payload returned from the API
     */

    get(endpoint) {
        return new Promise((resolve, reject) => {
            Auth.token()
                .then((token) => {
                    let req = {
                        uri: this._formatURI(endpoint),
                        json: true,
                        headers: {
                            "Authorization": token.authorization,
                            "User-Agent": config.global.userAgent
                        }
                    };
                    r(req)
                        .then((res) => {
                            resolve(res);
                        })
                        .catch((ex) => reject(ex));
                })
                .catch((ex) => this._handleEx(ex));
        });
    }

    /** post
     * @description Performs a POST request.
     * @param {string} endpoint to be called.
     * @param {object} JSON data to be sent to the server
     * @returns {Promise&lt;Object>} JSON payload returned from the API
     */
    post(endpoint, data) {
        return new Promise((resolve, reject) => {
            Auth.token()
                .then((token) => {
                    let req = {
                        method: 'POST',
                        uri: this._formatURI(endpoint),
                        json: true,
                        headers: {
                            "Authorization": token.authorization,
                            "User-Agent": config.global.userAgent
                        },
                        data: data
                    };
                    r(req)
                        .then((res) => {
                            resolve(res);
                        })
                        .catch((ex) => reject(ex));
                })
                .catch((ex) => this._handleEx(ex));
        });
    }

    /** put
     * @description Performs a PUT request.   You can also send in a blank object and append a path param to the endpoint.
     * @param {string} endpoint to be called.
     * @param {object} JSON data to be sent to the server
     * @returns {Promise&lt;Object>} JSON payload returned from the API
     */

    put(endpoint, data) {
        return new Promise((resolve, reject) => {
            Auth.token()
                .then((token) => {
                    let req = {
                        method: 'PUT',
                        uri: this._formatURI(endpoint),
                        json: true,
                        headers: {
                            "Authorization": token.authorization,
                            "User-Agent": config.global.userAgent
                        },
                        data: data
                    };
                    r(req)
                        .then((res) => {
                            resolve(res);
                        })
                        .catch((ex) => reject(ex));
                })
                .catch((ex) => this._handleEx(ex));
        });
    }

    /** delete
     * @description Performs a DELETE request.
     * @param {string} endpoint to be called.   Should include the path params or a query string with the resource you intend to delete.
     * @returns {Promise&lt;Object>} JSON payload returned from the API
     * @example
     * fortuna.$.delete('api/posts/delete/123456');
     */
    delete(endpoint, data) {
        return new Promise((resolve, reject) => {
            Auth.token()
                .then((token) => {
                    let req = {
                        method: 'DELETE',
                        uri: this._formatURI(endpoint),
                        json: true,
                        headers: {
                            "Authorization": token.authorization,
                            "User-Agent": config.global.userAgent
                        },
                    };
                    r(req)
                        .then((res) => {
                            resolve(res);
                        })
                        .catch((ex) => reject(ex));
                })
                .catch((ex) => this._handleEx(ex));
        });
    }


    _formatURI(endpoint) {
        return `${env.apiURL}/${endpoint}`;
    }

    /** Exception handler.
     * @description Exceptions from the API are piped to this method.   In the future this will support a formal logger function.
     * @param ex - Exception
     * @private
     *
     */

    _handleEx(ex) {
        console.log(ex);
        return;
    }

    _serialize(obj, prefix) {
        let str = [],
            p;
        for (p in obj) {
            if (obj.hasOwnProperty(p)) {
                var k = prefix ? prefix + "[" + p + "]" : p,
                    v = obj[p];
                str.push((v !== null &amp;&amp; typeof v === "object") ?
                    serialize(v, k) :
                    encodeURIComponent(k) + "=" + encodeURIComponent(v));
            }
        }
        return str.join("&amp;");
    }
}

module.exports = FortunaAPI;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Ping.html">Ping</a></li></ul><h3>Classes</h3><ul><li><a href="Auth.html">Auth</a></li><li><a href="FortunaAPI.html">FortunaAPI</a></li><li><a href="Token.html">Token</a></li><li><a href="User.html">User</a></li><li><a href="Users.html">Users</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Feb 11 2018 17:17:24 GMT-0800 (Pacific Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
